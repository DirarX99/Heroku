function displayLocation(a){var b=a.coords.latitude,c=a.coords.longitude,d=document.getElementById("location");d.innerHTML=b+" , "+c+"</br>",showMap(a.coords);var e=new google.maps.LatLng(b,c);createMarker(e)}function showMap(a){function e(a,b,c,d){google.maps.event.addListener(a,"click",function(){c.setContent(d),c.open(b,a)})}function f(a,b){var c=window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest;c.onreadystatechange=function(){4==c.readyState&&(c.onreadystatechange=g,b(c,c.status))},c.open("GET",a,!0),c.send(null)}function g(){}var b=new google.maps.LatLng(a.latitude,a.longitude),c={zoom:9,center:b,mapTypeId:google.maps.MapTypeId.TERRAIN},d=document.getElementById("map");map=new google.maps.Map(d,c),infoWindow=new google.maps.InfoWindow,google.maps.event.addListener(map,"click",function(a){var b=a.latLng.lat(),c=a.latLng.lng(),d=document.getElementById("location");d.innerHTML=b+","+c,markers.length>0?console.log("marker already created !,You can't add another one !"):(createMarker(a.latLng),map.panTo(a.latLng),nearestTower())}),radT1=1e4,radT2=5e3,createMainTower(),f("genxml.php",function(a){for(var b=a.responseXML,c=b.documentElement.getElementsByTagName("marker"),d=0;d<c.length;d++){var f=c[d].getAttribute("nom"),g=c[d].getAttribute("gouvernorat"),h=c[d].getAttribute("delegation"),i=new google.maps.LatLng(parseFloat(c[d].getAttribute("latitude")),parseFloat(c[d].getAttribute("longitude"))),j="<b> Antenne: "+f+"</b></br><b> Gouvernorat: "+g+"</br><b> Delegation: "+h+"</b>",k=new google.maps.Marker({map:map,position:i,icon:"hide.png",title:f});DBtowers.push(k),heatMapData.push(i),e(k,map,infoWindow,j)}}),nearestTower();var h=document.getElementById("pac-input"),i=new google.maps.places.Autocomplete(h);i.bindTo("bounds",map),i.addListener("place_changed",function(){marker.setVisible(!1);var a=i.getPlace();if(!a.geometry)return void window.alert("Autocomplete's returned place contains no geometry");a.geometry.viewport?map.fitBounds(a.geometry.viewport):(map.setCenter(a.geometry.location),map.setZoom(17)),createMarker(a.geometry.location);var b="";a.address_components&&(b=[a.address_components[0]&&a.address_components[0].short_name||"",a.address_components[1]&&a.address_components[1].short_name||"",a.address_components[2]&&a.address_components[2].short_name||""].join(" ")),nearestTower()});var j=new google.maps.Geocoder;document.getElementById("latlng");document.getElementById("submit").addEventListener("click",function(){marker.setVisible(!1);var a=document.getElementById("latlng").value,b=a.split(",",2),c={lat:parseFloat(b[0]),lng:parseFloat(b[1])};j.geocode({location:c},function(a,b){b===google.maps.GeocoderStatus.OK?a[1]?(map.setZoom(11),createMarker(c),map.setCenter(c),nearestTower()):window.alert("No results found"):window.alert("Geocoder failed due to: "+b)})})}function nearestTower(){setTimeout(function(){for(var a=0;a<DBtowers.length;a++){DBtowers[a].getPosition().lat(),DBtowers[a].getPosition().lng();test=marker.getPosition();var d=document.getElementById("test");d.innerHTML=test;var e=(google.maps.geometry.spherical.computeDistanceBetween(test,DBtowers[a].getPosition())/1e3).toFixed(2),f=document.getElementById("distance");distarray.push(e);var g=DBtowers[a].getTitle(),h=e;namedis[g]=h}var i=Math.min.apply(null,Object.keys(namedis).map(function(a){return namedis[a]}));nearest=Object.keys(namedis).filter(function(a){return namedis[a]==i})[0],console.log("the nearest point is : "+nearest),f.innerHTML=nearest,console.log("the final number of towers: "+DBtowers.length)},1e3)}function createMarker(a){var b={icon:"map-marker-s.png",position:a,map:map,clickable:!0,draggable:!0,animation:google.maps.Animation.DROP};marker=new google.maps.Marker(b),markers.push(marker),google.maps.event.addListener(marker,"dragend",function(a){console.log("marker dropped !");var b=document.getElementById("location");b.innerHTML=a.latLng.lat()+","+a.latLng.lng(),nearestTower()})}function createTowerMarker(a,b){markerTower=new google.maps.Marker({icon:"tower.png",position:a,map:map,title:"Tower!"}),towers.push(markerTower),towerCircle=new google.maps.Circle({strokeColor:"#FF0000",strokeOpacity:.5,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.1,map:map,center:a,radius:b})}function addTower(){var a=new google.maps.Geocoder;document.getElementById("addsubmit").addEventListener("click",function(){var b=document.getElementById("addrad").value,c=document.getElementById("addtower").value,d=c.split(",",2),e={lat:parseFloat(d[0]),lng:parseFloat(d[1])};a.geocode({location:e},function(a,c){c===google.maps.GeocoderStatus.OK?a[1]?(map.setZoom(12),createTowerMarker(e,parseInt(b)),map.setCenter(e)):window.alert("No results found"):window.alert("Geocoder failed due to: "+c)})})}function calcDistance(a,b){return(google.maps.geometry.spherical.computeDistanceBetween(a,b)/1e3).toFixed(2)}function returnPosition(){map.panTo(test)}function clearMarkers(){setMapOnAll(null)}function deleteMarkers(){clearMarkers(),markers=[]}function showMarkers(){setMapOnAll(map)}function setMapOnAll(a){for(var b=0;b<markers.length;b++)markers[b].setMap(a)}function displayError(a){}function openPanel(){document.getElementById("panel").style.width="25%",passValue(),getChaine(),createPath()}function closePanel(){document.getElementById("panel").style.width="0%"}function getChaine(){function b(b){switch(b){case 0:a="level0.png";break;case 1:a="level1.png";break;case 2:a="level1.png";break;case 3:a="level2.png";break;case 4:a="level2.png";break;case 5:a="level3.png";break;case 6:a="level3.png";break;case 7:a="level4.png";break;case 8:a="level4.png";break;case 9:a="level5.png";break;case 10:a="level5.png"}}function c(a,b){var c=window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest;c.onreadystatechange=function(){4==c.readyState&&(c.onreadystatechange=d,b(c,c.status))},c.open("GET",a,!0),c.send(null)}function d(){}c("genxmlChannel.php",function(c){var d=c.responseXML,e=d.documentElement.getElementsByTagName("chaine"),f="";f+="<th>Chaine</th><th>Signal</th>";for(var g=0;g<e.length;g++){var h=e[g].getAttribute("nom"),i=parseFloat(e[g].getAttribute("FS"));b(i),f+="<tr>",f+="<td width=70%>"+h+'</td><td><img src="'+a+'"></td>',f+="</tr>"}var j=document.getElementById("list");j.innerHTML="<table border=1>"+f+"</table>"});var a}function generatetable(){for(var b=(document.getElementsByTagName("chainelist")[0],document.createElement("table")),c=document.createElement("tbody"),d=0;d<8;d++){for(var e=document.createElement("tr"),f=0;f<2;f++){var g=document.createElement("td"),h=document.createTextNode("Dirar");g.appendChild(h),e.appendChild(g)}c.appendChild(e)}b.appendChild(c),chainelist.appendChild(b),b.setAttribute("border","1")}function passValue(){document.cookie="v="+nearest}function createMainTower(){function a(a,b,c,d){google.maps.event.addListener(a,"click",function(){c.setContent(d),c.open(b,a)})}function b(a,b){var d=window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest;d.onreadystatechange=function(){4==d.readyState&&(d.onreadystatechange=c,b(d,d.status))},d.open("GET",a,!0),d.send(null)}function c(){}b("genxmlMainTower.php",function(b){for(var c=b.responseXML,d=c.documentElement.getElementsByTagName("marker"),e=0;e<d.length;e++){var f=d[e].getAttribute("nom"),g=d[e].getAttribute("gouvernorat"),h=d[e].getAttribute("delegation"),i=new google.maps.LatLng(parseFloat(d[e].getAttribute("latitude")),parseFloat(d[e].getAttribute("longitude"))),j="<b> Antenne: "+f+"</b></br><b> Gouvernorat: "+g+"</br><b> Delegation: "+h+"</b>",k=new google.maps.Marker({map:map,position:i,icon:"tower.png",title:f});DBtowers.push(k),heatMapData.push(i),a(k,map,infoWindow,j)}})}function readCookie(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1,e.length);if(0==e.indexOf(b))return e.substring(b.length,e.length)}return null}function createPath(){function a(a,c){var d=window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest;d.onreadystatechange=function(){4==d.readyState&&(d.onreadystatechange=b,c(d,d.status))},d.open("GET",a,!0),d.send(null)}function b(){}poly=new google.maps.Polyline({strokeColor:"#0000FF",strokeOpacity:1,strokeWeight:3,map:map}),a("genxmlAcoords.php",function(a){for(var b=a.responseXML,c=b.documentElement.getElementsByTagName("Acoords"),d=0;d<c.length;d++){var e=parseFloat(c[d].getAttribute("latitude")),f=parseFloat(c[d].getAttribute("longitude")),g=new google.maps.LatLng(e,f);console.log(e+","+f);var h=[marker.getPosition(),g],i=google.maps.geometry.spherical.computeHeading(h[0],h[1]).toFixed();console.log(i+" degree");var j=document.getElementById("degree");j.innerHTML=i+"Â°",document.getElementById("needle").style.transform="rotate("+i+"deg)"}})}var map,infoWindow,markers=[],towers=[],DBtowers=[],markerTower,marker,myLatlng,myLatlng2,LatLng2,test,Latlng2,towerCircle,radT1,radT2,nearest,distarray=[],namedis={},heatMapData=[],poly;window.onload=function(){navigator.geolocation?navigator.geolocation.getCurrentPosition(displayLocation,displayError,{enableHighAccuracy:!0,timeout:1e4,maximumAge:0}):alert("Sorry, this browser doesn't support geolocation!")};